<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èšåˆçƒ­æ¦œ - å®æ—¶çƒ­ç‚¹è¿½è¸ª</title>
    <style>
        /* åŸºç¡€æ ·å¼ */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f7f6;
            color: #333;
            line-height: 1.6;
        }
        .container {
            max-width: 960px;
            margin: 0 auto;
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        .last-update {
            text-align: center;
            color: #7f8c8d;
            font-size: 0.9em;
            margin-bottom: 20px;
        }
        /* çƒ­æ¦œåˆ—è¡¨æ ·å¼ */
        .hot-list-section {
            margin-bottom: 40px;
        }
        .hot-list-section h2 {
            color: #34495e;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .hot-list {
            list-style: none;
            padding: 0;
        }
        .hot-list li {
            background-color: #fdfdfd;
            border: 1px solid #eee;
            padding: 12px 15px;
            margin-bottom: 8px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .hot-list li:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
        }
        .hot-list li .rank {
            font-weight: bold;
            color: #2980b9;
            margin-right: 15px;
            min-width: 25px;
            text-align: center;
        }
        .hot-list li a {
            flex-grow: 1;
            text-decoration: none;
            color: #3498db;
            font-size: 1.1em;
            word-break: break-word; /* é˜²æ­¢é•¿æ ‡é¢˜æº¢å‡º */
        }
        .hot-list li a:hover {
            text-decoration: underline;
        }
        /* çŠ¶æ€ä¿¡æ¯ */
        .loading-message, .error-message {
            text-align: center;
            font-size: 1.2em;
            color: #555;
        }
        .error-message {
            color: #e74c3c;
        }
        /* åˆ·æ–°æŒ‰é’®æ ·å¼ */
        .refresh-btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin: 10px auto;
            transition: background-color 0.3s ease;
        }
        .refresh-btn:hover {
            background-color: #2980b9;
        }
        .refresh-btn:active {
            transform: scale(0.98);
        }
        .refresh-btn:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        .button-container {
            text-align: center;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>èšåˆçƒ­æ¦œ</h1>
        <p class="last-update" id="last-update">æ•°æ®åŠ è½½ä¸­...</p>
        <div class="button-container">
            <button class="refresh-btn" id="refresh-btn" onclick="refreshData()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
        </div>
        <div id="hot-topics-container">
            <p class="loading-message">æ­£åœ¨åŠ è½½çƒ­æ¦œæ•°æ®...</p>
        </div>
    </div>

    <script>
        // åˆ·æ–°æ•°æ®çš„å‡½æ•°
        function refreshData() {
            const refreshBtn = document.getElementById('refresh-btn');
            const container = document.getElementById('hot-topics-container');
            const lastUpdateElem = document.getElementById('last-update');
            
            // ç¦ç”¨æŒ‰é’®ï¼Œæ˜¾ç¤ºåŠ è½½çŠ¶æ€
            refreshBtn.disabled = true;
            refreshBtn.textContent = 'ğŸ”„ åˆ·æ–°ä¸­...';
            container.innerHTML = '<p class="loading-message">æ­£åœ¨åˆ·æ–°æ•°æ®...</p>';
            lastUpdateElem.textContent = 'æ­£åœ¨åˆ·æ–°...';
            
            // è·å–æ•°æ®
            fetch('/api/hot_topics')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç : ' + response.status);
                    }
                    return response.json();
                })
                .then(data => {
                    renderData(data);
                    refreshBtn.disabled = false;
                    refreshBtn.textContent = 'ğŸ”„ åˆ·æ–°æ•°æ®';
                })
                .catch(error => {
                    console.error('è·å–çƒ­æ¦œæ•°æ®å¤±è´¥:', error);
                    container.innerHTML = `<p class="error-message">åˆ·æ–°å¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚</p>`;
                    lastUpdateElem.textContent = 'åˆ·æ–°å¤±è´¥';
                    refreshBtn.disabled = false;
                    refreshBtn.textContent = 'ğŸ”„ åˆ·æ–°æ•°æ®';
                });
        }
        
        // æ¸²æŸ“æ•°æ®çš„å‡½æ•°
        function renderData(data) {
            const container = document.getElementById('hot-topics-container');
            const lastUpdateElem = document.getElementById('last-update');
            
            container.innerHTML = '';
            
            // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´
            if (data.last_update) {
                lastUpdateElem.textContent = `æœ€åæ›´æ–°æ—¶é—´: ${data.last_update}`;
            } else {
                lastUpdateElem.textContent = 'æ•°æ®åŠ è½½ä¸­...';
            }
            
            // æ£€æŸ¥æ•°æ®æ˜¯å¦å­˜åœ¨ä¸”ä¸ä¸ºç©º
            if (!data.data || !Array.isArray(data.data) || data.data.length === 0) {
                container.innerHTML = `<p class="loading-message">æš‚æ— çƒ­æ¦œæ•°æ®ï¼Œè¯·ç¨åå†è¯•ã€‚</p>`;
                return;
            }
            
            // å°†è·å–åˆ°çš„çƒ­æ¦œæ•°æ®æŒ‰æ¥æºåˆ†ç»„
            const groupedTopics = data.data.reduce((acc, topic) => {
                if (!acc[topic.source]) {
                    acc[topic.source] = [];
                }
                acc[topic.source].push(topic);
                return acc;
            }, {});
            
            // æ£€æŸ¥æ˜¯å¦æœ‰åˆ†ç»„åçš„æ•°æ®
            if (Object.keys(groupedTopics).length === 0) {
                container.innerHTML = `<p class="loading-message">æš‚æ— çƒ­æ¦œæ•°æ®ï¼Œè¯·ç¨åå†è¯•ã€‚</p>`;
                return;
            }
            
            // éå†æ¯ä¸ªæ•°æ®æ¥æºï¼Œåˆ›å»ºå¯¹åº”çš„çƒ­æ¦œåˆ—è¡¨
            for (const source in groupedTopics) {
                const section = document.createElement('div');
                section.classList.add('hot-list-section');
                section.innerHTML = `<h2>${source}</h2>`;
                
                const ul = document.createElement('ul');
                ul.classList.add('hot-list');
                
                // å¯¹æ¯ä¸ªæ¥æºçš„çƒ­æ¦œæ¡ç›®è¿›è¡Œæ’åº
                const sortedSourceTopics = groupedTopics[source].sort((a, b) => {
                    if (a.rank && b.rank) {
                        return a.rank - b.rank;
                    }
                    return 0;
                });
                
                // éå†æ’åºåçš„çƒ­æ¦œæ¡ç›®ï¼Œåˆ›å»ºåˆ—è¡¨é¡¹
                sortedSourceTopics.forEach(topic => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <span class="rank">${topic.rank || ''}</span>
                        <a href="${topic.url}" target="_blank" rel="noopener noreferrer">${topic.title}</a>
                    `;
                    ul.appendChild(li);
                });
                section.appendChild(ul);
                container.appendChild(section);
            }
        }
        
        // å½“é¡µé¢å†…å®¹åŠ è½½å®Œæ¯•åæ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            // ä½¿ç”¨ fetch API å‘åç«¯å‘é€è¯·æ±‚è·å–æ•°æ®
            fetch('/api/hot_topics')
                .then(response => {
                    // æ£€æŸ¥HTTPå“åº”æ˜¯å¦æˆåŠŸ (çŠ¶æ€ç  200-299)
                    if (!response.ok) {
                        throw new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç : ' + response.status);
                    }
                    // å°†å“åº”ä½“è§£æä¸º JSON æ ¼å¼
                    return response.json();
                })
                .then(data => {
                    renderData(data);
                })
                .catch(error => {
                    // æ•è·å¹¶å¤„ç†è¯·æ±‚è¿‡ç¨‹ä¸­å‘ç”Ÿçš„é”™è¯¯
                    console.error('è·å–çƒ­æ¦œæ•°æ®å¤±è´¥:', error);
                    const container = document.getElementById('hot-topics-container');
                    container.innerHTML = `<p class="error-message">åŠ è½½çƒ­æ¦œæ•°æ®å¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚</p>`;
                    document.getElementById('last-update').textContent = 'æ•°æ®åŠ è½½å¤±è´¥';
                });
        });
    </script>
</body>
</html>